<!DOCTYPE html>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    
<style>

/* html, body, div, span, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
table, caption, tbody, tfoot, thead, tr, th, td {
  margin: 0;
  padding: 0;
  border: 0;
} */

.slideshow-image, .slideshow-video {
  display: block;
}

#content {
  padding: 0px;
}

.sticky-top {
  position: sticky;
  padding: 5px;
  top: 0;
}

.centerall {
  height: 100vh;
  padding: 0;
  display: flex;
  flex-wrap: nowrap;
  justify-content: center;
  align-items: center;
}


</style>


<div id="main-outer-div">

<!-- 
<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://bulma.io">
      <img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">
    </a>

    <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div id="navbarBasicExample" class="navbar-menu">
    <div class="navbar-start">
      <a class="navbar-item">
        Home
      </a>

      <a class="navbar-item">
        Documentation
      </a>

      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          More
        </a>

        <div class="navbar-dropdown">
          <a class="navbar-item">
            About
          </a>
          <a class="navbar-item">
            Jobs
          </a>
          <a class="navbar-item">
            Contact
          </a>
          <hr class="navbar-divider">
          <a class="navbar-item">
            Report an issue
          </a>
        </div>
      </div>
    </div>

    <div class="navbar-end">
      <div class="navbar-item">
        <div class="buttons">
          <a class="button is-primary">
            <strong>Sign up</strong>
          </a>
          <a class="button is-light">
            Log in
          </a>
        </div>
      </div>
    </div>
  </div>
</nav> -->

<nav class="navbar is-fixed-top" role="navigation">

<div class="navbar-brand">
  <a class="navbar-item" href="https://bulma.io">
    <img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">
  </a>

  <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
  </a>
</div>

<div id="navbarBasicExample" class="navbar-menu">
  <div class="navbar-start">

    <div class="navbar-item field has-addons">
      <div class="control">
        <input class="input is-rounded" type="text" id="search-box" name="search-box" required size="30">
      </div>
      <div class="control">
        <button class="button is-primary" id="search-button" onclick="searchClicked()">Search</button> 
      </div>
    </div>
  </div>

  <div class="navbar-end">
    <a class="navbar-item">
      Browse
    </a>

    <a class="navbar-item">
      Organize
    </a>
  </div>

</nav>

  <div id='content'></div>

</div>


<script src="pig.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="slideshow.js"></script>

<script>

var slideshow = photos.slideshow().duration(6).loop(false);

var pigOptions = {
  //containerId: 'content',
  urlForSize: function(imageData, size) {
    return `/getThumbnail?album=${imageData.album}&filename=${imageData.filename}&height=${size}`
  },
  onClickHandler: function(d,i,arr) {

    slideshow.startFrom(i).autoPlay(false);
    
    d3.select("#content").selectAll("*").style("display", "none");

    var slideshowDiv = d3.select("#content")
      .append("div")
        .attr("id", "slideshow")
      .call(slideshow, arr)
    ;
  },
};

function searchClicked(){
  let searchText = document.getElementById("search-box").value;
  searchText = searchText
    .replace(/([^"]+)|("[^"]+")/g, function($0, $1, $2) {
      if ($1) {
          return $1.replace(/\s/g, '&');
      } else {
          return $2; 
      } 
    });
  console.log(searchText);

  fetch("/search?"+searchText)
  .then(function(response){
    return response.json()
  })
  .then(function(result){
    console.log(result.length);
    let content = d3.select("#content");
    content.selectAll("*").remove();
    content.append("div")
      .attr("id", "pig")
    ;

    var pig = new Pig(result, pigOptions).enable();
  })
}

</script>
